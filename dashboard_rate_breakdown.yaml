# OVO Energy Australia - Rate Breakdown Dashboard
# Shows energy consumption and costs by rate type (EV Off-Peak, Free Period, Other Rates)
#
# Installation:
# 1. Install ApexCharts card from HACS: https://github.com/RomRider/apexcharts-card
# 2. Copy this file to your Home Assistant config
# 3. In Home Assistant, go to Settings â†’ Dashboards
# 4. Click "+ Add Dashboard" â†’ "New dashboard from scratch"
# 5. Enter "Edit Dashboard" mode (three dots menu â†’ "Edit Dashboard")
# 6. Click three dots menu â†’ "Raw configuration editor"
# 7. Paste the contents of this file
# 8. Save

type: vertical-stack
cards:
  # Monthly Summary Cards - Current Month Totals by Rate Type
  - type: horizontal-stack
    cards:
      - type: statistic
        entity: sensor.monthly_ev_offpeak_consumption
        name: EV Off-Peak
        icon: mdi:ev-station
        stat_type: total
        period:
          calendar:
            period: month

      - type: statistic
        entity: sensor.monthly_free_3_consumption
        name: Free Period
        icon: mdi:solar-power
        stat_type: total
        period:
          calendar:
            period: month

      - type: statistic
        entity: sensor.monthly_other_consumption
        name: Other Rates
        icon: mdi:lightning-bolt
        stat_type: total
        period:
          calendar:
            period: month

  # Monthly Cost Summary by Rate Type
  - type: horizontal-stack
    cards:
      - type: statistic
        entity: sensor.monthly_ev_offpeak_charge
        name: EV Off-Peak Cost
        icon: mdi:currency-usd
        stat_type: total
        period:
          calendar:
            period: month

      - type: statistic
        entity: sensor.monthly_free_3_charge
        name: Free Period Cost
        icon: mdi:currency-usd
        stat_type: total
        period:
          calendar:
            period: month

      - type: statistic
        entity: sensor.monthly_other_charge
        name: Other Rates Cost
        icon: mdi:currency-usd
        stat_type: total
        period:
          calendar:
            period: month

  # Stacked Consumption Chart - Daily Breakdown by Rate Type
  - type: custom:apexcharts-card
    header:
      show: true
      title: Monthly Consumption by Rate Type
      show_states: true
      colorize_states: true
    graph_span: 1month
    span:
      start: month
    series:
      - entity: sensor.monthly_ev_offpeak_consumption
        name: EV Off-Peak (00:00-06:00)
        type: column
        color: '#3498db'
        data_generator: |
          const daily = entity.attributes.rate_daily_breakdown || [];
          return daily.map(day => {
            return [new Date(day.date).getTime(), day.ev_offpeak.consumption];
          });
        show:
          in_header: false

      - entity: sensor.monthly_free_3_consumption
        name: Free Period (11:00-14:00)
        type: column
        color: '#2ecc71'
        data_generator: |
          const daily = entity.attributes.rate_daily_breakdown || [];
          return daily.map(day => {
            return [new Date(day.date).getTime(), day.free_3.consumption];
          });
        show:
          in_header: false

      - entity: sensor.monthly_other_consumption
        name: Other Rates (Peak/Shoulder)
        type: column
        color: '#e74c3c'
        data_generator: |
          const daily = entity.attributes.rate_daily_breakdown || [];
          return daily.map(day => {
            return [new Date(day.date).getTime(), day.other.consumption];
          });
        show:
          in_header: false
    apex_config:
      chart:
        height: 350px
        stacked: true
      xaxis:
        type: datetime
        labels:
          format: dd
      yaxis:
        - title:
            text: Consumption (kWh)
      dataLabels:
        enabled: false
      tooltip:
        x:
          format: dd MMM yyyy
        y:
          formatter: 'function(value) { return value.toFixed(2) + " kWh"; }'
      legend:
        show: true
        position: top

  # Stacked Cost Chart - Daily Breakdown by Rate Type
  - type: custom:apexcharts-card
    header:
      show: true
      title: Monthly Costs by Rate Type
      show_states: true
      colorize_states: true
    graph_span: 1month
    span:
      start: month
    series:
      - entity: sensor.monthly_ev_offpeak_charge
        name: EV Off-Peak Cost
        type: column
        color: '#3498db'
        data_generator: |
          const daily = entity.attributes.rate_daily_breakdown || [];
          return daily.map(day => {
            return [new Date(day.date).getTime(), day.ev_offpeak.charge];
          });
        show:
          in_header: false

      - entity: sensor.monthly_free_3_charge
        name: Free Period Cost
        type: column
        color: '#2ecc71'
        data_generator: |
          const daily = entity.attributes.rate_daily_breakdown || [];
          return daily.map(day => {
            return [new Date(day.date).getTime(), day.free_3.charge];
          });
        show:
          in_header: false

      - entity: sensor.monthly_other_charge
        name: Other Rates Cost
        type: column
        color: '#e74c3c'
        data_generator: |
          const daily = entity.attributes.rate_daily_breakdown || [];
          return daily.map(day => {
            return [new Date(day.date).getTime(), day.other.charge];
          });
        show:
          in_header: false
    apex_config:
      chart:
        height: 350px
        stacked: true
      xaxis:
        type: datetime
        labels:
          format: dd
      yaxis:
        - title:
            text: Cost (AUD)
          decimalsInFloat: 2
      dataLabels:
        enabled: false
      tooltip:
        x:
          format: dd MMM yyyy
        y:
          formatter: 'function(value) { return "$" + value.toFixed(2); }'
      legend:
        show: true
        position: top

  # Yearly Breakdown - Entities Card
  - type: entities
    title: Yearly Rate Breakdown
    entities:
      - type: section
        label: EV Off-Peak (00:00-06:00)
      - entity: sensor.yearly_ev_offpeak_consumption
        name: Yearly EV Off-Peak Consumption
      - entity: sensor.yearly_ev_offpeak_charge
        name: Yearly EV Off-Peak Cost

      - type: section
        label: Free Period (11:00-14:00)
      - entity: sensor.yearly_free_3_consumption
        name: Yearly Free Period Consumption
      - entity: sensor.yearly_free_3_charge
        name: Yearly Free Period Cost

      - type: section
        label: Other Rates (Peak/Shoulder)
      - entity: sensor.yearly_other_consumption
        name: Yearly Other Rates Consumption
      - entity: sensor.yearly_other_charge
        name: Yearly Other Rates Cost

  # Daily Breakdown - Entities Card
  - type: entities
    title: Yesterday's Rate Breakdown
    entities:
      - type: section
        label: EV Off-Peak (00:00-06:00)
      - entity: sensor.daily_ev_offpeak_consumption
        name: EV Off-Peak Consumption
      - entity: sensor.daily_ev_offpeak_charge
        name: EV Off-Peak Cost

      - type: section
        label: Free Period (11:00-14:00)
      - entity: sensor.daily_free_3_consumption
        name: Free Period Consumption
      - entity: sensor.daily_free_3_charge
        name: Free Period Cost

      - type: section
        label: Other Rates (Peak/Shoulder)
      - entity: sensor.daily_other_consumption
        name: Other Rates Consumption
      - entity: sensor.daily_other_charge
        name: Other Rates Cost

  # Rate Information Card
  - type: markdown
    content: |
      ## Rate Types Explained

      **EV Off-Peak** (Blue): Super off-peak charging period (00:00-06:00)
      - Typically lowest rates for EV plan customers
      - Ideal for charging electric vehicles overnight

      **Free Period** (Green): Free energy period (11:00-14:00)
      - Free 3 plan customers pay $0 during this period
      - Great time to run high-consumption appliances

      **Other Rates** (Red): Peak and shoulder periods
      - Standard rates during high-demand times
      - Includes all other consumption periods

      ---

      **Color Coding:**
      - ðŸ”µ Blue = EV Off-Peak
      - ðŸŸ¢ Green = Free Period
      - ðŸ”´ Red = Other Rates
